#!/bin/bash
# Full system test script for ROBOCON workspace
# Tests all nodes working together according to AGENTS.md specifications

echo "=========================================="
echo "ü§ñ ROBOCON Full System Test"
echo "=========================================="
echo ""

# Source the workspace
source /home/robotics/robocon/new_ws/install/setup.bash

echo "Checking available packages (AGENTS.md compliant):"
echo "üì¶ Core Packages:"
echo "  - my_joystick_driver     # Hand controller driver"
echo "  - my_joystick_msgs       # Hand controller messages"  
echo "  - joystick_bridge        # Controller to chassis bridge"
echo "  - base_omniwheel_r2_700  # Omniwheel chassis control"
echo ""

echo "=========================================="
echo "üéÆ Hand Controller Operation Guide"
echo "=========================================="
echo ""
echo "To control the robot chassis with hand controller:"
echo ""
echo "üöÄ Quick Start (Recommended):"
echo "  ./launch_hand_controller.sh"
echo ""
echo "üîß Manual Start (Step by step):"
echo "  Terminal 1 - Joystick driver:"
echo "    ros2 run my_joystick_driver joystick_node"
echo ""
echo "  Terminal 2 - Control bridge:"  
echo "    ros2 run joystick_bridge joystick_bridge"
echo ""
echo "  Terminal 3 - Motor controller:"
echo "    ros2 run base_omniwheel_r2_700 damiao_node"
echo ""
echo "  Terminal 4 - Navigation controller:"
echo "    ros2 run base_omniwheel_r2_700 local_navigation_node"
echo ""
echo "=========================================="
echo "üïπÔ∏è  Controller Mapping (AGENTS.md Compliant)"
echo "=========================================="
echo ""
echo "Left Stick (lx, ly):"
echo "  - X-axis (lx): Movement direction (-8192 to 8192)"
echo "  - Y-axis (ly): Translation speed magnitude"
echo "  - Deadzone: ¬±410 units (‚âà5%) to prevent drift"
echo ""
echo "Right Stick (rx):"
echo "  - X-axis (rx): Rotation speed control"
echo "  - Range: -8192 to 8192 ‚Üí -2.0 to 2.0 rad/s"
echo ""
echo "Output Format:"
echo "  /local_driving topic: [direction_rad, speed_cm/s, rotation_rad/s]"
echo ""
echo "=========================================="
echo "üîç Debugging and Monitoring"
echo "=========================================="
echo ""
echo "Real-time data monitoring:"
echo "  # View raw joystick input"
echo "  ros2 topic echo /joystick_data"
echo ""
echo "  # View navigation commands"  
echo "  ros2 topic echo /local_driving"
echo ""
echo "  # View motor commands"
echo "  ros2 topic echo /damiao_control"
echo ""
echo "System diagnostics:"
echo "  # Check node status"
echo "  ros2 node list"
echo ""
echo "  # Check topic connections"
echo "  ros2 topic list"
echo ""
echo "  # Monitor publishing frequency"
echo "  ros2 topic hz /local_driving"
echo ""
echo "=========================================="
echo "üõ°Ô∏è  Safety Features (AGENTS.md 9.1 Compliant)"
echo "=========================================="
echo ""
echo "‚úÖ Timeout Protection:"
echo "  - Joystick disconnection ‚Üí automatic zero-state"
echo "  - Node shutdown ‚Üí safe motor stop"
echo "  - Deadzone filtering ‚Üí prevent drift control"
echo ""
echo "‚úÖ Parameterized Control:"
echo "  - Configurable speed limits"
echo "  - Adjustable deadzone thresholds"
echo "  - Flexible device detection"
echo ""
echo "‚úÖ Clear Interface Design:"
echo "  - Well-defined topic contracts"
echo "  - Standardized message formats"
echo "  - Decoupled node architecture"
echo ""
echo "=========================================="
echo "üìã Quick Test Commands"
echo "=========================================="
echo ""
echo "# Test forward movement (50 cm/s)"
echo "ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray \"{data: [0.0, 50.0, 0.0]}\" --once"
echo ""
echo "# Test right movement (30 cm/s)"  
echo "ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray \"{data: [1.57, 30.0, 0.0]}\" --once"
echo ""
echo "# Test rotation only (1 rad/s CCW)"
echo "ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray \"{data: [0.0, 0.0, 1.0]}\" --once"
echo ""
echo "# Emergency stop"
echo "ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray \"{data: [0.0, 0.0, 0.0]}\" --once"
echo ""
echo "=========================================="
echo "‚úÖ System Ready - AGENTS.md Compliant!"
echo "=========================================="