#!/bin/bash
# Complete Hand Controller System Test with CAN Bus

echo "=========================================="
echo "üéÆ Complete Hand Controller System Test"
echo "=========================================="
echo ""

echo "‚úÖ CAN Bus Converter Status:"
echo "   - Device: HDSC CDC Device (ÂçéÂ§ßÂçäÂØº‰Ωì)"
echo "   - Path: /dev/ttyACM0"
echo "   - Status: DETECTED and ACCESSIBLE"
echo ""

echo "‚úÖ System Components Verified:"
echo "   - ROS2 Jazzy: ‚úì Working"
echo "   - Hand Controller Driver: ‚úì Available"
echo "   - Joystick Bridge: ‚úì Available"  
echo "   - Motor Controller: ‚úì Available"
echo "   - Omniwheel Navigation: ‚úì Available"
echo ""

echo "üîß Next Steps to Control Your Base:"

echo ""
echo "1. Fix User Permissions (One-time setup):"
echo "   sudo usermod -a -G dialout $USER"
echo "   # Then logout and login again"
echo ""

echo "2. Test Complete Control Chain:"
echo "   ./launch_hand_controller.sh"
echo ""

echo "3. Manual Test Commands:"
echo "   # In terminal 1 - Start system"
echo "   ./launch_hand_controller.sh"
echo ""
echo "   # In terminal 2 - Test movement"
echo "   ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray '{data: [0.0, 50.0, 0.0]}' --once"
echo "   ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray '{data: [1.57, 30.0, 0.0]}' --once" 
echo "   ros2 topic pub /local_driving std_msgs/msg/Float32MultiArray '{data: [0.0, 0.0, 1.0]}' --once"
echo ""

echo "4. Monitor System:"
echo "   # View joystick input"
echo "   ros2 topic echo /joystick_data"
echo ""
echo "   # View motor commands"
echo "   ros2 topic echo /damiao_control"
echo ""

echo "5. Connect Physical Controller:"
echo "   - Pair your 8BitDo controller via Bluetooth"
echo "   - Or connect via USB"
echo "   - Move joysticks to test response"
echo ""

echo "‚ö†Ô∏è  Prerequisites Check:"
echo "   - [ ] Motor power is ON"
echo "   - [ ] CAN bus wiring is correct"
echo "   - [ ] All 4 motors are connected"
echo "   - [ ] User added to dialout group"
echo ""

echo "üéØ Expected Results:"
echo "   - Joystick movements ‚Üí /joystick_data changes"
echo "   - /local_driving commands generated"
echo "   - /damiao_control motor commands sent"
echo "   - Physical robot movement"
echo ""

echo "üÜò Troubleshooting:"
echo "   Run: ./diagnose_damiao.sh  # Detailed motor diagnostics"
echo "   Run: ./check_jazzy_compatibility.sh  # System verification"
echo "   Check: Are motors physically responding?"
echo "   Check: Is CAN converter LED indicating activity?"
echo ""